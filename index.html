<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reader / Writer App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom styling for the textarea to extend to the bottom */
      textarea.full-height {
        height: calc(
          100vh - 5rem
        ); /* 100vh is the viewport height, 4rem is an estimation for the header height and spacing */
      }

      div.h-full {
        height: calc(100vh - 5rem); /* Adjust for header */
        overflow-y: auto;
      }
      /* To make space for the file list on the left */
      textarea.full-height {
        height: calc(100vh - 5rem);
        width: calc(800px - 16rem); /* Subtracting the sidebar's width */
        margin-left: 16rem; /* Pushing the editor to the right of the sidebar */
      }
      ul#fileList li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fff;
        padding: 8px;
        border-radius: 8px;
        transition: background 0.3s;
      }

      ul#fileList li:hover {
        background: #f0f0f0;
      }

      ul#fileList li.active {
        background: #e2e8f0;
      }

      .deleteBtn {
        color: red;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s;
      }

      ul#fileList li:hover .deleteBtn {
        opacity: 1;
      }
    </style>
  </head>
  <body class="bg-gray-100 h-screen flex flex-col items-center">
    <!-- Header -->
    <div class="w-full bg-blue-500 text-white text-center py-2">
      <h1 class="text-2xl">Reader / Writer App</h1>
    </div>

    <div class="h-full fixed left-0 top-0 w-64 bg-gray-100 border-r p-4">
      <ul id="fileList" class="space-y-2">
        <!-- Files will be added dynamically here -->
      </ul>
      <button
        id="addFile"
        class="block w-full bg-blue-500 hover:bg-blue-600 text-white py-2 mt-4 rounded-md"
      >
        + New
      </button>
    </div>

    <!-- Textbox (textarea) -->
    <div class="mt-4">
      <textarea
        id="textArea"
        class="resize rounded-md px-3 py-2 text-base border rounded-md full-height"
        style="
          font-size: 22px;
          width: 800px;
          line-height: 30px;
          text-align: justify;
        "
      ></textarea>
    </div>

    <script>
      function handleDelete(e, filename) {
        e.stopPropagation();
        if (confirm("Are you sure you want to delete this file?")) {
          localStorage.removeItem(`file_${filename}`);
          e.target.closest("li").remove();
          if (currentFile === filename) {
            document.getElementById("textArea").value = "";
          }
        }
      }

      // When command-s is pressed, do nothing
      document.addEventListener("keydown", (event) => {
        if (event.keyCode === 83 && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
        }
      });

      // Focus on the textarea on page load
      window.onload = function () {
        document.getElementById("textArea").focus();
        // scroll to the top of the textarea
        document.getElementById("textArea").scrollTop = 0;
      };
      // Load text from localStorage on page load
      document.addEventListener("DOMContentLoaded", (event) => {
        const textArea = document.getElementById("textArea");
        const savedText = localStorage.getItem(`file_${currentFile}`);
        if (savedText) {
          textArea.value = savedText;
        }
      });

      // Update localStorage whenever the textarea is updated
      document.getElementById("textArea").addEventListener("input", (event) => {
        localStorage.setItem("textAreaContent", event.target.value);
      });

      let currentFile = "defaultFile"; // Keeps track of the currently opened file

      // Load all filenames into the sidebar on page load
      document.addEventListener("DOMContentLoaded", () => {
        const fileList = document.getElementById("fileList");
        const files = Object.keys(localStorage).filter((key) =>
          key.startsWith("file_")
        );
        files.sort().forEach((file) => {
          const li = document.createElement("li");
          li.innerHTML = `<span>${file.replace(
            "file_",
            ""
          )}</span><span class="deleteBtn">×</span>`;
          li.querySelector(".deleteBtn").onclick = (e) =>
            handleDelete(e, file.replace("file_", ""));
          li.onclick = () => loadFile(file.replace("file_", ""));
          fileList.appendChild(li);
        });
      });

      // Load a file's content into the editor
      function loadFile(filename) {
        const content = localStorage.getItem(`file_${filename}`);
        document.getElementById("textArea").value = content || "";
        currentFile = filename;

        // Highlight the active file
        document.querySelectorAll("#fileList li").forEach((li) => {
          if (li.textContent.includes(filename)) {
            li.classList.add("active");
          } else {
            li.classList.remove("active");
          }
        });
      }

      // Update save logic to take currentFile into account
      document.getElementById("textArea").addEventListener("input", (event) => {
        localStorage.setItem(`file_${currentFile}`, event.target.value);
      });

      // Logic for adding new files
      document.getElementById("addFile").addEventListener("click", () => {
        const filename = prompt("Enter filename:");
        if (filename) {
          const li = document.createElement("li");
          li.innerHTML = `<span>${filename}</span><span class="deleteBtn">×</span>`;
          li.querySelector(".deleteBtn").onclick = (e) => {
            e.stopPropagation();
            if (confirm("Are you sure you want to delete this file?")) {
              localStorage.removeItem(`file_${filename}`);
              li.remove();
              if (currentFile === filename) {
                document.getElementById("textArea").value = "";
              }
            }
          };
          li.onclick = () => loadFile(filename);
          document.getElementById("fileList").appendChild(li);
          document.getElementById("textArea").value = "";
          currentFile = filename;
          // Highlight the newly created file
          document.querySelectorAll("#fileList li").forEach((li) => {
            if (li.textContent.includes(filename)) {
              li.classList.add("active");
            } else {
              li.classList.remove("active");
            }
          });
        }
      });
    </script>
  </body>
</html>
